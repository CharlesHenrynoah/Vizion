/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/projects/route";
exports.ids = ["app/api/projects/route"];
exports.modules = {

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("bcrypt");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "perf_hooks":
/*!*****************************!*\
  !*** external "perf_hooks" ***!
  \*****************************/
/***/ ((module) => {

"use strict";
module.exports = require("perf_hooks");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fprojects%2Froute&page=%2Fapi%2Fprojects%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprojects%2Froute.ts&appDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fprojects%2Froute&page=%2Fapi%2Fprojects%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprojects%2Froute.ts&appDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_charles_henrynoah_Desktop_vizion_Vizion_app_api_projects_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/projects/route.ts */ \"(rsc)/./app/api/projects/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/projects/route\",\n        pathname: \"/api/projects\",\n        filename: \"route\",\n        bundlePath: \"app/api/projects/route\"\n    },\n    resolvedPagePath: \"/Users/charles-henrynoah/Desktop/vizion/Vizion/app/api/projects/route.ts\",\n    nextConfigOutput,\n    userland: _Users_charles_henrynoah_Desktop_vizion_Vizion_app_api_projects_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZwcm9qZWN0cyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcHJvamVjdHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZwcm9qZWN0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNoYXJsZXMtaGVucnlub2FoJTJGRGVza3RvcCUyRnZpemlvbiUyRlZpemlvbiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZjaGFybGVzLWhlbnJ5bm9haCUyRkRlc2t0b3AlMkZ2aXppb24lMkZWaXppb24maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ3dCO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGOztBQUUxRiIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvY2hhcmxlcy1oZW5yeW5vYWgvRGVza3RvcC92aXppb24vVml6aW9uL2FwcC9hcGkvcHJvamVjdHMvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb2plY3RzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcHJvamVjdHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Byb2plY3RzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2NoYXJsZXMtaGVucnlub2FoL0Rlc2t0b3Avdml6aW9uL1Zpemlvbi9hcHAvYXBpL3Byb2plY3RzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fprojects%2Froute&page=%2Fapi%2Fprojects%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprojects%2Froute.ts&appDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./app/api/projects/route.ts":
/*!***********************************!*\
  !*** ./app/api/projects/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_auth_auth_options__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/auth/auth-options */ \"(rsc)/./lib/auth/auth-options.ts\");\n\n\n\n\n// GET /api/projects - Récupérer tous les projets de l'utilisateur\nasync function GET(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth_auth_options__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n        if (!session || !session.user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Non autorisé'\n            }, {\n                status: 401\n            });\n        }\n        const userId = session.user.id;\n        try {\n            // Récupérer les projets dont l'utilisateur est propriétaire\n            const { data: ownedProjects, error: ownedError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').select('*').eq('owner_id', userId).eq('is_active', true);\n            if (ownedError) {\n                console.error('Erreur lors de la récupération des projets:', ownedError);\n                throw ownedError;\n            }\n            // Récupérer les projets dont l'utilisateur est membre\n            const { data: memberProjects, error: memberError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('project_members').select('project_id, projects(*)').eq('user_id', userId).eq('projects.is_active', true);\n            if (memberError) {\n                console.error('Erreur lors de la récupération des projets membres:', memberError);\n                throw memberError;\n            }\n            // Combiner les projets (en évitant les doublons)\n            const allProjects = [\n                ...ownedProjects || [],\n                ...(memberProjects || []).map((mp)=>mp.projects)\n            ];\n            // Éliminer les doublons\n            const uniqueProjects = Array.from(new Map(allProjects.map((project)=>[\n                    project.id,\n                    project\n                ])).values());\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(uniqueProjects);\n        } catch (dbError) {\n            console.error('Erreur lors de la récupération des projets:', dbError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json([], {\n                status: 200\n            }); // Retourner un tableau vide en cas d'erreur\n        }\n    } catch (error) {\n        console.error('Erreur serveur lors de la récupération des projets:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json([], {\n            status: 200\n        }); // Retourner un tableau vide en cas d'erreur\n    }\n}\n// POST /api/projects - Créer un nouveau projet\nasync function POST(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth_auth_options__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n        if (!session || !session.user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Not authorized'\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { name, description, color, icon } = body;\n        if (!name) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Project name required'\n            }, {\n                status: 400\n            });\n        }\n        try {\n            // Log user ID for debugging\n            console.log('Creating project with user ID:', session.user.id);\n            console.log('User ID type:', typeof session.user.id);\n            // Create project with Supabase\n            const { data: newProject, error } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').insert({\n                name,\n                description: description || '',\n                owner_id: String(session.user.id),\n                color: color || '#3b82f6',\n                icon: icon || 'clipboard',\n                is_active: true,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            }).select().single();\n            if (error) {\n                console.error('Error creating project:', error);\n                throw error;\n            }\n            // Log successful project creation\n            console.log('Project created successfully:', newProject);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(newProject);\n        } catch (dbError) {\n            console.error('Database error while creating project:', dbError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Error creating project'\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error('Server error while creating project:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Server error'\n        }, {\n            status: 500\n        });\n    }\n}\n// PUT /api/projects - Mettre à jour un projet\nasync function PUT(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth_auth_options__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n        if (!session || !session.user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Non autorisé'\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { id, name, description, color, icon } = body;\n        if (!id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'ID de projet requis'\n            }, {\n                status: 400\n            });\n        }\n        try {\n            // Vérifier que l'utilisateur est le propriétaire du projet\n            const { data: projectData, error: getError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').select('*').eq('id', id).single();\n            if (getError || !projectData) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Projet non trouvé'\n                }, {\n                    status: 404\n                });\n            }\n            if (projectData.owner_id !== session.user.id.toString()) {\n                // Vérifier si l'utilisateur est au moins membre avec des privilèges d'édition\n                const { data: memberData, error: memberError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('project_members').select('*').eq('project_id', id).eq('user_id', session.user.id.toString()).in('role', [\n                    'admin',\n                    'owner'\n                ]).single();\n                if (memberError || !memberData) {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: 'Non autorisé à modifier ce projet'\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n            // Mettre à jour le projet\n            const { data: updatedProject, error: updateError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').update({\n                name: name || projectData.name,\n                description: description !== undefined ? description : projectData.description,\n                color: color || projectData.color,\n                icon: icon || projectData.icon,\n                updated_at: new Date().toISOString()\n            }).eq('id', id).select().single();\n            if (updateError) {\n                console.error('Erreur lors de la mise à jour du projet:', updateError);\n                throw updateError;\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(updatedProject);\n        } catch (dbError) {\n            console.error('Erreur de base de données lors de la mise à jour du projet:', dbError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Erreur lors de la mise à jour du projet'\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error('Erreur serveur lors de la mise à jour du projet:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Erreur serveur'\n        }, {\n            status: 500\n        });\n    }\n}\n// DELETE /api/projects - Supprimer un projet\nasync function DELETE(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth_auth_options__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n        if (!session || !session.user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Non autorisé'\n            }, {\n                status: 401\n            });\n        }\n        const url = new URL(request.url);\n        const id = url.searchParams.get('id');\n        if (!id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'ID de projet requis'\n            }, {\n                status: 400\n            });\n        }\n        try {\n            // Vérifier que l'utilisateur est le propriétaire du projet\n            const { data: projectData, error: getError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').select('*').eq('id', id).single();\n            if (getError || !projectData) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Projet non trouvé'\n                }, {\n                    status: 404\n                });\n            }\n            if (projectData.owner_id !== session.user.id.toString()) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Non autorisé à supprimer ce projet'\n                }, {\n                    status: 403\n                });\n            }\n            // Supprimer le projet (soft delete)\n            const { error: deleteError } = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from('projects').update({\n                is_active: false,\n                updated_at: new Date().toISOString()\n            }).eq('id', id);\n            if (deleteError) {\n                console.error('Erreur lors de la suppression du projet:', deleteError);\n                throw deleteError;\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true\n            });\n        } catch (dbError) {\n            console.error('Erreur de base de données lors de la suppression du projet:', dbError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Erreur lors de la suppression du projet'\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error('Erreur serveur lors de la suppression du projet:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Erreur serveur'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3Byb2plY3RzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUF3RDtBQUNmO0FBQ0k7QUFDZ0I7QUFFN0Qsa0VBQWtFO0FBQzNELGVBQWVJLElBQUlDLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1KLDJEQUFnQkEsQ0FBQ0MsK0RBQVdBO1FBQ2xELElBQUksQ0FBQ0csV0FBVyxDQUFDQSxRQUFRQyxJQUFJLEVBQUU7WUFDN0IsT0FBT1AscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNwRTtRQUVBLE1BQU1DLFNBQVNMLFFBQVFDLElBQUksQ0FBQ0ssRUFBRTtRQUU5QixJQUFJO1lBQ0YsNERBQTREO1lBQzVELE1BQU0sRUFBRUMsTUFBTUMsYUFBYSxFQUFFTCxPQUFPTSxVQUFVLEVBQUUsR0FBRyxNQUFNZCxrREFBYUEsQ0FDbkVlLElBQUksQ0FBQyxZQUNMQyxNQUFNLENBQUMsS0FDUEMsRUFBRSxDQUFDLFlBQVlQLFFBQ2ZPLEVBQUUsQ0FBQyxhQUFhO1lBRW5CLElBQUlILFlBQVk7Z0JBQ2RJLFFBQVFWLEtBQUssQ0FBQywrQ0FBK0NNO2dCQUM3RCxNQUFNQTtZQUNSO1lBRUEsc0RBQXNEO1lBQ3RELE1BQU0sRUFBRUYsTUFBTU8sY0FBYyxFQUFFWCxPQUFPWSxXQUFXLEVBQUUsR0FBRyxNQUFNcEIsa0RBQWFBLENBQ3JFZSxJQUFJLENBQUMsbUJBQ0xDLE1BQU0sQ0FBQywyQkFDUEMsRUFBRSxDQUFDLFdBQVdQLFFBQ2RPLEVBQUUsQ0FBQyxzQkFBc0I7WUFFNUIsSUFBSUcsYUFBYTtnQkFDZkYsUUFBUVYsS0FBSyxDQUFDLHVEQUF1RFk7Z0JBQ3JFLE1BQU1BO1lBQ1I7WUFFQSxpREFBaUQ7WUFDakQsTUFBTUMsY0FBYzttQkFDZFIsaUJBQWlCLEVBQUU7bUJBQ3BCLENBQUNNLGtCQUFrQixFQUFFLEVBQUVHLEdBQUcsQ0FBQ0MsQ0FBQUEsS0FBTUEsR0FBR0MsUUFBUTthQUNoRDtZQUVELHdCQUF3QjtZQUN4QixNQUFNQyxpQkFBaUJDLE1BQU1YLElBQUksQ0FDL0IsSUFBSVksSUFBSU4sWUFBWUMsR0FBRyxDQUFDTSxDQUFBQSxVQUFXO29CQUFDQSxRQUFRakIsRUFBRTtvQkFBRWlCO2lCQUFRLEdBQUdDLE1BQU07WUFHbkUsT0FBTzlCLHFEQUFZQSxDQUFDUSxJQUFJLENBQUNrQjtRQUMzQixFQUFFLE9BQU9LLFNBQVM7WUFDaEJaLFFBQVFWLEtBQUssQ0FBQywrQ0FBK0NzQjtZQUM3RCxPQUFPL0IscURBQVlBLENBQUNRLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQUVFLFFBQVE7WUFBSSxJQUFJLDRDQUE0QztRQUM3RjtJQUNGLEVBQUUsT0FBT0QsT0FBTztRQUNkVSxRQUFRVixLQUFLLENBQUMsdURBQXVEQTtRQUNyRSxPQUFPVCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUFFRSxRQUFRO1FBQUksSUFBSSw0Q0FBNEM7SUFDN0Y7QUFDRjtBQUVBLCtDQUErQztBQUN4QyxlQUFlc0IsS0FBSzNCLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1KLDJEQUFnQkEsQ0FBQ0MsK0RBQVdBO1FBQ2xELElBQUksQ0FBQ0csV0FBVyxDQUFDQSxRQUFRQyxJQUFJLEVBQUU7WUFDN0IsT0FBT1AscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFpQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDdEU7UUFFQSxNQUFNdUIsT0FBTyxNQUFNNUIsUUFBUUcsSUFBSTtRQUMvQixNQUFNLEVBQUUwQixJQUFJLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUUsR0FBR0o7UUFFM0MsSUFBSSxDQUFDQyxNQUFNO1lBQ1QsT0FBT2xDLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBd0IsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzdFO1FBRUEsSUFBSTtZQUNGLDRCQUE0QjtZQUM1QlMsUUFBUW1CLEdBQUcsQ0FBQyxrQ0FBa0NoQyxRQUFRQyxJQUFJLENBQUNLLEVBQUU7WUFDN0RPLFFBQVFtQixHQUFHLENBQUMsaUJBQWlCLE9BQU9oQyxRQUFRQyxJQUFJLENBQUNLLEVBQUU7WUFFbkQsK0JBQStCO1lBQy9CLE1BQU0sRUFBRUMsTUFBTTBCLFVBQVUsRUFBRTlCLEtBQUssRUFBRSxHQUFHLE1BQU1SLGtEQUFhQSxDQUNwRGUsSUFBSSxDQUFDLFlBQ0x3QixNQUFNLENBQUM7Z0JBQ05OO2dCQUNBQyxhQUFhQSxlQUFlO2dCQUM1Qk0sVUFBVUMsT0FBT3BDLFFBQVFDLElBQUksQ0FBQ0ssRUFBRTtnQkFDaEN3QixPQUFPQSxTQUFTO2dCQUNoQkMsTUFBTUEsUUFBUTtnQkFDZE0sV0FBVztnQkFDWEMsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO2dCQUNsQ0MsWUFBWSxJQUFJRixPQUFPQyxXQUFXO1lBQ3BDLEdBQ0M3QixNQUFNLEdBQ04rQixNQUFNO1lBRVQsSUFBSXZDLE9BQU87Z0JBQ1RVLFFBQVFWLEtBQUssQ0FBQywyQkFBMkJBO2dCQUN6QyxNQUFNQTtZQUNSO1lBRUEsa0NBQWtDO1lBQ2xDVSxRQUFRbUIsR0FBRyxDQUFDLGlDQUFpQ0M7WUFFN0MsT0FBT3ZDLHFEQUFZQSxDQUFDUSxJQUFJLENBQUMrQjtRQUMzQixFQUFFLE9BQU9SLFNBQVM7WUFDaEJaLFFBQVFWLEtBQUssQ0FBQywwQ0FBMENzQjtZQUN4RCxPQUFPL0IscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF5QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDOUU7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWUsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDcEU7QUFDRjtBQUVBLDhDQUE4QztBQUN2QyxlQUFldUMsSUFBSTVDLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1KLDJEQUFnQkEsQ0FBQ0MsK0RBQVdBO1FBQ2xELElBQUksQ0FBQ0csV0FBVyxDQUFDQSxRQUFRQyxJQUFJLEVBQUU7WUFDN0IsT0FBT1AscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNwRTtRQUVBLE1BQU11QixPQUFPLE1BQU01QixRQUFRRyxJQUFJO1FBQy9CLE1BQU0sRUFBRUksRUFBRSxFQUFFc0IsSUFBSSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFLEdBQUdKO1FBRS9DLElBQUksQ0FBQ3JCLElBQUk7WUFDUCxPQUFPWixxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXNCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUMzRTtRQUVBLElBQUk7WUFDRiwyREFBMkQ7WUFDM0QsTUFBTSxFQUFFRyxNQUFNcUMsV0FBVyxFQUFFekMsT0FBTzBDLFFBQVEsRUFBRSxHQUFHLE1BQU1sRCxrREFBYUEsQ0FDL0RlLElBQUksQ0FBQyxZQUNMQyxNQUFNLENBQUMsS0FDUEMsRUFBRSxDQUFDLE1BQU1OLElBQ1RvQyxNQUFNO1lBRVQsSUFBSUcsWUFBWSxDQUFDRCxhQUFhO2dCQUM1QixPQUFPbEQscURBQVlBLENBQUNRLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBb0IsR0FBRztvQkFBRUMsUUFBUTtnQkFBSTtZQUN6RTtZQUVBLElBQUl3QyxZQUFZVCxRQUFRLEtBQUtuQyxRQUFRQyxJQUFJLENBQUNLLEVBQUUsQ0FBQ3dDLFFBQVEsSUFBSTtnQkFDdkQsOEVBQThFO2dCQUM5RSxNQUFNLEVBQUV2QyxNQUFNd0MsVUFBVSxFQUFFNUMsT0FBT1ksV0FBVyxFQUFFLEdBQUcsTUFBTXBCLGtEQUFhQSxDQUNqRWUsSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUMsS0FDUEMsRUFBRSxDQUFDLGNBQWNOLElBQ2pCTSxFQUFFLENBQUMsV0FBV1osUUFBUUMsSUFBSSxDQUFDSyxFQUFFLENBQUN3QyxRQUFRLElBQ3RDRSxFQUFFLENBQUMsUUFBUTtvQkFBQztvQkFBUztpQkFBUSxFQUM3Qk4sTUFBTTtnQkFFVCxJQUFJM0IsZUFBZSxDQUFDZ0MsWUFBWTtvQkFDOUIsT0FBT3JELHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7d0JBQUVDLE9BQU87b0JBQW9DLEdBQUc7d0JBQUVDLFFBQVE7b0JBQUk7Z0JBQ3pGO1lBQ0Y7WUFFQSwwQkFBMEI7WUFDMUIsTUFBTSxFQUFFRyxNQUFNMEMsY0FBYyxFQUFFOUMsT0FBTytDLFdBQVcsRUFBRSxHQUFHLE1BQU12RCxrREFBYUEsQ0FDckVlLElBQUksQ0FBQyxZQUNMeUMsTUFBTSxDQUFDO2dCQUNOdkIsTUFBTUEsUUFBUWdCLFlBQVloQixJQUFJO2dCQUM5QkMsYUFBYUEsZ0JBQWdCdUIsWUFBWXZCLGNBQWNlLFlBQVlmLFdBQVc7Z0JBQzlFQyxPQUFPQSxTQUFTYyxZQUFZZCxLQUFLO2dCQUNqQ0MsTUFBTUEsUUFBUWEsWUFBWWIsSUFBSTtnQkFDOUJVLFlBQVksSUFBSUYsT0FBT0MsV0FBVztZQUNwQyxHQUNDNUIsRUFBRSxDQUFDLE1BQU1OLElBQ1RLLE1BQU0sR0FDTitCLE1BQU07WUFFVCxJQUFJUSxhQUFhO2dCQUNmckMsUUFBUVYsS0FBSyxDQUFDLDRDQUE0QytDO2dCQUMxRCxNQUFNQTtZQUNSO1lBRUEsT0FBT3hELHFEQUFZQSxDQUFDUSxJQUFJLENBQUMrQztRQUMzQixFQUFFLE9BQU94QixTQUFTO1lBQ2hCWixRQUFRVixLQUFLLENBQUMsK0RBQStEc0I7WUFDN0UsT0FBTy9CLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBMEMsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQy9GO0lBQ0YsRUFBRSxPQUFPRCxPQUFPO1FBQ2RVLFFBQVFWLEtBQUssQ0FBQyxvREFBb0RBO1FBQ2xFLE9BQU9ULHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFpQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN0RTtBQUNGO0FBRUEsNkNBQTZDO0FBQ3RDLGVBQWVpRCxPQUFPdEQsT0FBb0I7SUFDL0MsSUFBSTtRQUNGLE1BQU1DLFVBQVUsTUFBTUosMkRBQWdCQSxDQUFDQywrREFBV0E7UUFDbEQsSUFBSSxDQUFDRyxXQUFXLENBQUNBLFFBQVFDLElBQUksRUFBRTtZQUM3QixPQUFPUCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQWUsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3BFO1FBRUEsTUFBTWtELE1BQU0sSUFBSUMsSUFBSXhELFFBQVF1RCxHQUFHO1FBQy9CLE1BQU1oRCxLQUFLZ0QsSUFBSUUsWUFBWSxDQUFDQyxHQUFHLENBQUM7UUFFaEMsSUFBSSxDQUFDbkQsSUFBSTtZQUNQLE9BQU9aLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBc0IsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzNFO1FBRUEsSUFBSTtZQUNGLDJEQUEyRDtZQUMzRCxNQUFNLEVBQUVHLE1BQU1xQyxXQUFXLEVBQUV6QyxPQUFPMEMsUUFBUSxFQUFFLEdBQUcsTUFBTWxELGtEQUFhQSxDQUMvRGUsSUFBSSxDQUFDLFlBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsTUFBTU4sSUFDVG9DLE1BQU07WUFFVCxJQUFJRyxZQUFZLENBQUNELGFBQWE7Z0JBQzVCLE9BQU9sRCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUFvQixHQUFHO29CQUFFQyxRQUFRO2dCQUFJO1lBQ3pFO1lBRUEsSUFBSXdDLFlBQVlULFFBQVEsS0FBS25DLFFBQVFDLElBQUksQ0FBQ0ssRUFBRSxDQUFDd0MsUUFBUSxJQUFJO2dCQUN2RCxPQUFPcEQscURBQVlBLENBQUNRLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBcUMsR0FBRztvQkFBRUMsUUFBUTtnQkFBSTtZQUMxRjtZQUVBLG9DQUFvQztZQUNwQyxNQUFNLEVBQUVELE9BQU91RCxXQUFXLEVBQUUsR0FBRyxNQUFNL0Qsa0RBQWFBLENBQy9DZSxJQUFJLENBQUMsWUFDTHlDLE1BQU0sQ0FBQztnQkFBRWQsV0FBVztnQkFBT0ksWUFBWSxJQUFJRixPQUFPQyxXQUFXO1lBQUcsR0FDaEU1QixFQUFFLENBQUMsTUFBTU47WUFFWixJQUFJb0QsYUFBYTtnQkFDZjdDLFFBQVFWLEtBQUssQ0FBQyw0Q0FBNEN1RDtnQkFDMUQsTUFBTUE7WUFDUjtZQUVBLE9BQU9oRSxxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO2dCQUFFeUQsU0FBUztZQUFLO1FBQzNDLEVBQUUsT0FBT2xDLFNBQVM7WUFDaEJaLFFBQVFWLEtBQUssQ0FBQywrREFBK0RzQjtZQUM3RSxPQUFPL0IscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUEwQyxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDL0Y7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFDLG9EQUFvREE7UUFDbEUsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWlCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3RFO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaGFybGVzLWhlbnJ5bm9haC9EZXNrdG9wL3Zpemlvbi9WaXppb24vYXBwL2FwaS9wcm9qZWN0cy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL2RiJztcbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgnO1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9saWIvYXV0aC9hdXRoLW9wdGlvbnMnO1xuXG4vLyBHRVQgL2FwaS9wcm9qZWN0cyAtIFLDqWN1cMOpcmVyIHRvdXMgbGVzIHByb2pldHMgZGUgbCd1dGlsaXNhdGV1clxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKGF1dGhPcHRpb25zKTtcbiAgICBpZiAoIXNlc3Npb24gfHwgIXNlc3Npb24udXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOb24gYXV0b3Jpc8OpJyB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJJZCA9IHNlc3Npb24udXNlci5pZDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBSw6ljdXDDqXJlciBsZXMgcHJvamV0cyBkb250IGwndXRpbGlzYXRldXIgZXN0IHByb3ByacOpdGFpcmVcbiAgICAgIGNvbnN0IHsgZGF0YTogb3duZWRQcm9qZWN0cywgZXJyb3I6IG93bmVkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSk7XG5cbiAgICAgIGlmIChvd25lZEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBsb3JzIGRlIGxhIHLDqWN1cMOpcmF0aW9uIGRlcyBwcm9qZXRzOicsIG93bmVkRXJyb3IpO1xuICAgICAgICB0aHJvdyBvd25lZEVycm9yO1xuICAgICAgfVxuXG4gICAgICAvLyBSw6ljdXDDqXJlciBsZXMgcHJvamV0cyBkb250IGwndXRpbGlzYXRldXIgZXN0IG1lbWJyZVxuICAgICAgY29uc3QgeyBkYXRhOiBtZW1iZXJQcm9qZWN0cywgZXJyb3I6IG1lbWJlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKCdwcm9qZWN0X21lbWJlcnMnKVxuICAgICAgICAuc2VsZWN0KCdwcm9qZWN0X2lkLCBwcm9qZWN0cygqKScpXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLmVxKCdwcm9qZWN0cy5pc19hY3RpdmUnLCB0cnVlKTtcblxuICAgICAgaWYgKG1lbWJlckVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBsb3JzIGRlIGxhIHLDqWN1cMOpcmF0aW9uIGRlcyBwcm9qZXRzIG1lbWJyZXM6JywgbWVtYmVyRXJyb3IpO1xuICAgICAgICB0aHJvdyBtZW1iZXJFcnJvcjtcbiAgICAgIH1cblxuICAgICAgLy8gQ29tYmluZXIgbGVzIHByb2pldHMgKGVuIMOpdml0YW50IGxlcyBkb3VibG9ucylcbiAgICAgIGNvbnN0IGFsbFByb2plY3RzID0gW1xuICAgICAgICAuLi4ob3duZWRQcm9qZWN0cyB8fCBbXSksXG4gICAgICAgIC4uLihtZW1iZXJQcm9qZWN0cyB8fCBbXSkubWFwKG1wID0+IG1wLnByb2plY3RzKVxuICAgICAgXTtcblxuICAgICAgLy8gw4lsaW1pbmVyIGxlcyBkb3VibG9uc1xuICAgICAgY29uc3QgdW5pcXVlUHJvamVjdHMgPSBBcnJheS5mcm9tKFxuICAgICAgICBuZXcgTWFwKGFsbFByb2plY3RzLm1hcChwcm9qZWN0ID0+IFtwcm9qZWN0LmlkLCBwcm9qZWN0XSkpLnZhbHVlcygpXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24odW5pcXVlUHJvamVjdHMpO1xuICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBsb3JzIGRlIGxhIHLDqWN1cMOpcmF0aW9uIGRlcyBwcm9qZXRzOicsIGRiRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFtdLCB7IHN0YXR1czogMjAwIH0pOyAvLyBSZXRvdXJuZXIgdW4gdGFibGVhdSB2aWRlIGVuIGNhcyBkJ2VycmV1clxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgc2VydmV1ciBsb3JzIGRlIGxhIHLDqWN1cMOpcmF0aW9uIGRlcyBwcm9qZXRzOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oW10sIHsgc3RhdHVzOiAyMDAgfSk7IC8vIFJldG91cm5lciB1biB0YWJsZWF1IHZpZGUgZW4gY2FzIGQnZXJyZXVyXG4gIH1cbn1cblxuLy8gUE9TVCAvYXBpL3Byb2plY3RzIC0gQ3LDqWVyIHVuIG5vdXZlYXUgcHJvamV0XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKGF1dGhPcHRpb25zKTtcbiAgICBpZiAoIXNlc3Npb24gfHwgIXNlc3Npb24udXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgY29sb3IsIGljb24gfSA9IGJvZHk7XG5cbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnUHJvamVjdCBuYW1lIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBMb2cgdXNlciBJRCBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgcHJvamVjdCB3aXRoIHVzZXIgSUQ6Jywgc2Vzc2lvbi51c2VyLmlkKTtcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIElEIHR5cGU6JywgdHlwZW9mIHNlc3Npb24udXNlci5pZCk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBwcm9qZWN0IHdpdGggU3VwYWJhc2VcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvamVjdCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICAgICAgb3duZXJfaWQ6IFN0cmluZyhzZXNzaW9uLnVzZXIuaWQpLCAvLyBFbnN1cmUgSUQgaXMgYSBzdHJpbmdcbiAgICAgICAgICBjb2xvcjogY29sb3IgfHwgJyMzYjgyZjYnLFxuICAgICAgICAgIGljb246IGljb24gfHwgJ2NsaXBib2FyZCcsXG4gICAgICAgICAgaXNfYWN0aXZlOiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2plY3Q6JywgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgcHJvamVjdCBjcmVhdGlvblxuICAgICAgY29uc29sZS5sb2coJ1Byb2plY3QgY3JlYXRlZCBzdWNjZXNzZnVsbHk6JywgbmV3UHJvamVjdCk7XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihuZXdQcm9qZWN0KTtcbiAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBlcnJvciB3aGlsZSBjcmVhdGluZyBwcm9qZWN0OicsIGRiRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdFcnJvciBjcmVhdGluZyBwcm9qZWN0JyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdTZXJ2ZXIgZXJyb3Igd2hpbGUgY3JlYXRpbmcgcHJvamVjdDonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdTZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cblxuLy8gUFVUIC9hcGkvcHJvamVjdHMgLSBNZXR0cmUgw6Agam91ciB1biBwcm9qZXRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG4gICAgaWYgKCFzZXNzaW9uIHx8ICFzZXNzaW9uLnVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm9uIGF1dG9yaXPDqScgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBpZCwgbmFtZSwgZGVzY3JpcHRpb24sIGNvbG9yLCBpY29uIH0gPSBib2R5O1xuXG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJRCBkZSBwcm9qZXQgcmVxdWlzJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBWw6lyaWZpZXIgcXVlIGwndXRpbGlzYXRldXIgZXN0IGxlIHByb3ByacOpdGFpcmUgZHUgcHJvamV0XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2plY3REYXRhLCBlcnJvcjogZ2V0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBpZiAoZ2V0RXJyb3IgfHwgIXByb2plY3REYXRhKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnUHJvamV0IG5vbiB0cm91dsOpJyB9LCB7IHN0YXR1czogNDA0IH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvamVjdERhdGEub3duZXJfaWQgIT09IHNlc3Npb24udXNlci5pZC50b1N0cmluZygpKSB7XG4gICAgICAgIC8vIFbDqXJpZmllciBzaSBsJ3V0aWxpc2F0ZXVyIGVzdCBhdSBtb2lucyBtZW1icmUgYXZlYyBkZXMgcHJpdmlsw6hnZXMgZCfDqWRpdGlvblxuICAgICAgICBjb25zdCB7IGRhdGE6IG1lbWJlckRhdGEsIGVycm9yOiBtZW1iZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgICAgIC5mcm9tKCdwcm9qZWN0X21lbWJlcnMnKVxuICAgICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAgIC5lcSgncHJvamVjdF9pZCcsIGlkKVxuICAgICAgICAgIC5lcSgndXNlcl9pZCcsIHNlc3Npb24udXNlci5pZC50b1N0cmluZygpKVxuICAgICAgICAgIC5pbigncm9sZScsIFsnYWRtaW4nLCAnb3duZXInXSlcbiAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgaWYgKG1lbWJlckVycm9yIHx8ICFtZW1iZXJEYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOb24gYXV0b3Jpc8OpIMOgIG1vZGlmaWVyIGNlIHByb2pldCcgfSwgeyBzdGF0dXM6IDQwMyB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBNZXR0cmUgw6Agam91ciBsZSBwcm9qZXRcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2plY3QsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgICAuZnJvbSgncHJvamVjdHMnKVxuICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICBuYW1lOiBuYW1lIHx8IHByb2plY3REYXRhLm5hbWUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgPyBkZXNjcmlwdGlvbiA6IHByb2plY3REYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGNvbG9yOiBjb2xvciB8fCBwcm9qZWN0RGF0YS5jb2xvcixcbiAgICAgICAgICBpY29uOiBpY29uIHx8IHByb2plY3REYXRhLmljb24sXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0pXG4gICAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBsb3JzIGRlIGxhIG1pc2Ugw6Agam91ciBkdSBwcm9qZXQ6JywgdXBkYXRlRXJyb3IpO1xuICAgICAgICB0aHJvdyB1cGRhdGVFcnJvcjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHVwZGF0ZWRQcm9qZWN0KTtcbiAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgZGUgYmFzZSBkZSBkb25uw6llcyBsb3JzIGRlIGxhIG1pc2Ugw6Agam91ciBkdSBwcm9qZXQ6JywgZGJFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0VycmV1ciBsb3JzIGRlIGxhIG1pc2Ugw6Agam91ciBkdSBwcm9qZXQnIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBzZXJ2ZXVyIGxvcnMgZGUgbGEgbWlzZSDDoCBqb3VyIGR1IHByb2pldDonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdFcnJldXIgc2VydmV1cicgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuXG4vLyBERUxFVEUgL2FwaS9wcm9qZWN0cyAtIFN1cHByaW1lciB1biBwcm9qZXRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG4gICAgaWYgKCFzZXNzaW9uIHx8ICFzZXNzaW9uLnVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm9uIGF1dG9yaXPDqScgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBpZCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdpZCcpO1xuXG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJRCBkZSBwcm9qZXQgcmVxdWlzJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBWw6lyaWZpZXIgcXVlIGwndXRpbGlzYXRldXIgZXN0IGxlIHByb3ByacOpdGFpcmUgZHUgcHJvamV0XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2plY3REYXRhLCBlcnJvcjogZ2V0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBpZiAoZ2V0RXJyb3IgfHwgIXByb2plY3REYXRhKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnUHJvamV0IG5vbiB0cm91dsOpJyB9LCB7IHN0YXR1czogNDA0IH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvamVjdERhdGEub3duZXJfaWQgIT09IHNlc3Npb24udXNlci5pZC50b1N0cmluZygpKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm9uIGF1dG9yaXPDqSDDoCBzdXBwcmltZXIgY2UgcHJvamV0JyB9LCB7IHN0YXR1czogNDAzIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTdXBwcmltZXIgbGUgcHJvamV0IChzb2Z0IGRlbGV0ZSlcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKCdwcm9qZWN0cycpXG4gICAgICAgIC51cGRhdGUoeyBpc19hY3RpdmU6IGZhbHNlLCB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSlcbiAgICAgICAgLmVxKCdpZCcsIGlkKTtcblxuICAgICAgaWYgKGRlbGV0ZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBsb3JzIGRlIGxhIHN1cHByZXNzaW9uIGR1IHByb2pldDonLCBkZWxldGVFcnJvcik7XG4gICAgICAgIHRocm93IGRlbGV0ZUVycm9yO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pO1xuICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBkZSBiYXNlIGRlIGRvbm7DqWVzIGxvcnMgZGUgbGEgc3VwcHJlc3Npb24gZHUgcHJvamV0OicsIGRiRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdFcnJldXIgbG9ycyBkZSBsYSBzdXBwcmVzc2lvbiBkdSBwcm9qZXQnIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBzZXJ2ZXVyIGxvcnMgZGUgbGEgc3VwcHJlc3Npb24gZHUgcHJvamV0OicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0VycmV1ciBzZXJ2ZXVyJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic3VwYWJhc2VBZG1pbiIsImdldFNlcnZlclNlc3Npb24iLCJhdXRoT3B0aW9ucyIsIkdFVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwidXNlciIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInVzZXJJZCIsImlkIiwiZGF0YSIsIm93bmVkUHJvamVjdHMiLCJvd25lZEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiY29uc29sZSIsIm1lbWJlclByb2plY3RzIiwibWVtYmVyRXJyb3IiLCJhbGxQcm9qZWN0cyIsIm1hcCIsIm1wIiwicHJvamVjdHMiLCJ1bmlxdWVQcm9qZWN0cyIsIkFycmF5IiwiTWFwIiwicHJvamVjdCIsInZhbHVlcyIsImRiRXJyb3IiLCJQT1NUIiwiYm9keSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImNvbG9yIiwiaWNvbiIsImxvZyIsIm5ld1Byb2plY3QiLCJpbnNlcnQiLCJvd25lcl9pZCIsIlN0cmluZyIsImlzX2FjdGl2ZSIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0Iiwic2luZ2xlIiwiUFVUIiwicHJvamVjdERhdGEiLCJnZXRFcnJvciIsInRvU3RyaW5nIiwibWVtYmVyRGF0YSIsImluIiwidXBkYXRlZFByb2plY3QiLCJ1cGRhdGVFcnJvciIsInVwZGF0ZSIsInVuZGVmaW5lZCIsIkRFTEVURSIsInVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsImdldCIsImRlbGV0ZUVycm9yIiwic3VjY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/projects/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/auth-options.ts":
/*!**********************************!*\
  !*** ./lib/auth/auth-options.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/google */ \"(rsc)/./node_modules/next-auth/providers/google.js\");\n/* harmony import */ var next_auth_providers_github__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/github */ \"(rsc)/./node_modules/next-auth/providers/github.js\");\n/* harmony import */ var _db_queries__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./db-queries */ \"(rsc)/./lib/auth/db-queries.ts\");\n\n\n\n\nconst authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                try {\n                    const user = await (0,_db_queries__WEBPACK_IMPORTED_MODULE_3__.verifyUserCredentials)(credentials.email, credentials.password);\n                    return user;\n                } catch (error) {\n                    console.error(\"Error during authentication:\", error);\n                    return null;\n                }\n            }\n        }),\n        (0,next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\"\n        }),\n        (0,next_auth_providers_github__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n            clientId: process.env.GITHUB_ID || \"\",\n            clientSecret: process.env.GITHUB_SECRET || \"\"\n        })\n    ],\n    pages: {\n        signIn: \"/login\",\n        signOut: \"/\",\n        error: \"/login\"\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 30 * 24 * 60 * 60\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.id = user.id;\n                token.name = user.name;\n                token.email = user.email;\n                token.picture = user.avatar || user.profile_photo;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token && session.user) {\n                session.user.id = token.id;\n                session.user.name = token.name;\n                session.user.email = token.email;\n                session.user.image = token.picture;\n            }\n            return session;\n        }\n    },\n    secret: process.env.NEXTAUTH_SECRET,\n    debug: \"development\" === \"development\"\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9hdXRoLW9wdGlvbnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDa0U7QUFDVjtBQUNBO0FBQ0g7QUFFOUMsTUFBTUksY0FBK0I7SUFDMUNDLFdBQVc7UUFDVEwsMkVBQW1CQSxDQUFDO1lBQ2xCTSxNQUFNO1lBQ05DLGFBQWE7Z0JBQ1hDLE9BQU87b0JBQUVDLE9BQU87b0JBQVNDLE1BQU07Z0JBQVE7Z0JBQ3ZDQyxVQUFVO29CQUFFRixPQUFPO29CQUFZQyxNQUFNO2dCQUFXO1lBQ2xEO1lBQ0EsTUFBTUUsV0FBVUwsV0FBVztnQkFDekIsSUFBSSxDQUFDQSxhQUFhQyxTQUFTLENBQUNELGFBQWFJLFVBQVU7b0JBQ2pELE9BQU87Z0JBQ1Q7Z0JBRUEsSUFBSTtvQkFDRixNQUFNRSxPQUFPLE1BQU1WLGtFQUFxQkEsQ0FDdENJLFlBQVlDLEtBQUssRUFDakJELFlBQVlJLFFBQVE7b0JBRXRCLE9BQU9FO2dCQUNULEVBQUUsT0FBT0MsT0FBTztvQkFDZEMsUUFBUUQsS0FBSyxDQUFDLGdDQUFnQ0E7b0JBQzlDLE9BQU87Z0JBQ1Q7WUFDRjtRQUNGO1FBQ0FiLHNFQUFjQSxDQUFDO1lBQ2JlLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0MsZ0JBQWdCLElBQUk7WUFDMUNDLGNBQWNILFFBQVFDLEdBQUcsQ0FBQ0csb0JBQW9CLElBQUk7UUFDcEQ7UUFDQW5CLHNFQUFjQSxDQUFDO1lBQ2JjLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0ksU0FBUyxJQUFJO1lBQ25DRixjQUFjSCxRQUFRQyxHQUFHLENBQUNLLGFBQWEsSUFBSTtRQUM3QztLQUNEO0lBQ0RDLE9BQU87UUFDTEMsUUFBUTtRQUNSQyxTQUFTO1FBQ1RaLE9BQU87SUFDVDtJQUNBYSxTQUFTO1FBQ1BDLFVBQVU7UUFDVkMsUUFBUSxLQUFLLEtBQUssS0FBSztJQUN6QjtJQUNBQyxXQUFXO1FBQ1QsTUFBTUMsS0FBSSxFQUFFQyxLQUFLLEVBQUVuQixJQUFJLEVBQUU7WUFDdkIsSUFBSUEsTUFBTTtnQkFDUm1CLE1BQU1DLEVBQUUsR0FBR3BCLEtBQUtvQixFQUFFO2dCQUNsQkQsTUFBTTFCLElBQUksR0FBR08sS0FBS1AsSUFBSTtnQkFDdEIwQixNQUFNeEIsS0FBSyxHQUFHSyxLQUFLTCxLQUFLO2dCQUN4QndCLE1BQU1FLE9BQU8sR0FBR3JCLEtBQUtzQixNQUFNLElBQUl0QixLQUFLdUIsYUFBYTtZQUNuRDtZQUNBLE9BQU9KO1FBQ1Q7UUFDQSxNQUFNTCxTQUFRLEVBQUVBLE9BQU8sRUFBRUssS0FBSyxFQUFFO1lBQzlCLElBQUlBLFNBQVNMLFFBQVFkLElBQUksRUFBRTtnQkFDekJjLFFBQVFkLElBQUksQ0FBQ29CLEVBQUUsR0FBR0QsTUFBTUMsRUFBRTtnQkFDMUJOLFFBQVFkLElBQUksQ0FBQ1AsSUFBSSxHQUFHMEIsTUFBTTFCLElBQUk7Z0JBQzlCcUIsUUFBUWQsSUFBSSxDQUFDTCxLQUFLLEdBQUd3QixNQUFNeEIsS0FBSztnQkFDaENtQixRQUFRZCxJQUFJLENBQUN3QixLQUFLLEdBQUdMLE1BQU1FLE9BQU87WUFDcEM7WUFDQSxPQUFPUDtRQUNUO0lBQ0Y7SUFDQVcsUUFBUXJCLFFBQVFDLEdBQUcsQ0FBQ3FCLGVBQWU7SUFDbkNDLE9BQU92QixrQkFBeUI7QUFDbEMsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL2NoYXJsZXMtaGVucnlub2FoL0Rlc2t0b3Avdml6aW9uL1Zpemlvbi9saWIvYXV0aC9hdXRoLW9wdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEF1dGhPcHRpb25zIH0gZnJvbSBcIm5leHQtYXV0aFwiO1xuaW1wb3J0IENyZWRlbnRpYWxzUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHNcIjtcbmltcG9ydCBHb29nbGVQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9nb29nbGVcIjtcbmltcG9ydCBHaXRIdWJQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9naXRodWJcIjtcbmltcG9ydCB7IHZlcmlmeVVzZXJDcmVkZW50aWFscyB9IGZyb20gXCIuL2RiLXF1ZXJpZXNcIjtcblxuZXhwb3J0IGNvbnN0IGF1dGhPcHRpb25zOiBOZXh0QXV0aE9wdGlvbnMgPSB7XG4gIHByb3ZpZGVyczogW1xuICAgIENyZWRlbnRpYWxzUHJvdmlkZXIoe1xuICAgICAgbmFtZTogXCJjcmVkZW50aWFsc1wiLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6IFwiRW1haWxcIiwgdHlwZTogXCJlbWFpbFwiIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IGxhYmVsOiBcIlBhc3N3b3JkXCIsIHR5cGU6IFwicGFzc3dvcmRcIiB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHM/LmVtYWlsIHx8ICFjcmVkZW50aWFscz8ucGFzc3dvcmQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHZlcmlmeVVzZXJDcmVkZW50aWFscyhcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB1c2VyO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgYXV0aGVudGljYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pLFxuICAgIEdvb2dsZVByb3ZpZGVyKHtcbiAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEIHx8IFwiXCIsXG4gICAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUIHx8IFwiXCIsXG4gICAgfSksXG4gICAgR2l0SHViUHJvdmlkZXIoe1xuICAgICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LkdJVEhVQl9JRCB8fCBcIlwiLFxuICAgICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5HSVRIVUJfU0VDUkVUIHx8IFwiXCIsXG4gICAgfSksXG4gIF0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiBcIi9sb2dpblwiLFxuICAgIHNpZ25PdXQ6IFwiL1wiLFxuICAgIGVycm9yOiBcIi9sb2dpblwiLFxuICB9LFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6IFwiand0XCIsXG4gICAgbWF4QWdlOiAzMCAqIDI0ICogNjAgKiA2MCwgLy8gMzAgZGF5c1xuICB9LFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5pZCA9IHVzZXIuaWQ7XG4gICAgICAgIHRva2VuLm5hbWUgPSB1c2VyLm5hbWU7XG4gICAgICAgIHRva2VuLmVtYWlsID0gdXNlci5lbWFpbDtcbiAgICAgICAgdG9rZW4ucGljdHVyZSA9IHVzZXIuYXZhdGFyIHx8IHVzZXIucHJvZmlsZV9waG90bztcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b2tlbjtcbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4gJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLmlkIGFzIHN0cmluZztcbiAgICAgICAgc2Vzc2lvbi51c2VyLm5hbWUgPSB0b2tlbi5uYW1lO1xuICAgICAgICBzZXNzaW9uLnVzZXIuZW1haWwgPSB0b2tlbi5lbWFpbCBhcyBzdHJpbmc7XG4gICAgICAgIHNlc3Npb24udXNlci5pbWFnZSA9IHRva2VuLnBpY3R1cmUgYXMgc3RyaW5nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb247XG4gICAgfSxcbiAgfSxcbiAgc2VjcmV0OiBwcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQsXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiLFxufTtcbiJdLCJuYW1lcyI6WyJDcmVkZW50aWFsc1Byb3ZpZGVyIiwiR29vZ2xlUHJvdmlkZXIiLCJHaXRIdWJQcm92aWRlciIsInZlcmlmeVVzZXJDcmVkZW50aWFscyIsImF1dGhPcHRpb25zIiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJwYXNzd29yZCIsImF1dGhvcml6ZSIsInVzZXIiLCJlcnJvciIsImNvbnNvbGUiLCJjbGllbnRJZCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiR09PR0xFX0NMSUVOVF9TRUNSRVQiLCJHSVRIVUJfSUQiLCJHSVRIVUJfU0VDUkVUIiwicGFnZXMiLCJzaWduSW4iLCJzaWduT3V0Iiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwibWF4QWdlIiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJpZCIsInBpY3R1cmUiLCJhdmF0YXIiLCJwcm9maWxlX3Bob3RvIiwiaW1hZ2UiLCJzZWNyZXQiLCJORVhUQVVUSF9TRUNSRVQiLCJkZWJ1ZyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/auth-options.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/db-queries.ts":
/*!********************************!*\
  !*** ./lib/auth/db-queries.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findOrCreateOAuthUser: () => (/* binding */ findOrCreateOAuthUser),\n/* harmony export */   verifyUserCredentials: () => (/* binding */ verifyUserCredentials)\n/* harmony export */ });\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\n// Créer le client Supabase\nconst supabaseUrl = \"https://ffwfdogonvgzudzsdcri.supabase.co\" || 0;\nconst supabaseKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2Zkb2dvbnZnenVkenNkY3JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMzMTg1MDQsImV4cCI6MjA1ODg5NDUwNH0.dfUnoBwD56sgNINPI-tLAuaMJ7PuGPuQanAJ_YrwOGI\" || 0;\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseKey);\n/**\n * Vérifie les identifiants de l'utilisateur pour l'authentification\n */ async function verifyUserCredentials(email, password) {\n    try {\n        console.log(`Attempting to verify credentials for email: ${email}`);\n        // Rechercher l'utilisateur par email\n        const { data, error } = await supabase.from('users').select('id, email, name, password, avatar').eq('email', email).maybeSingle(); // Using maybeSingle instead of single to avoid errors when no user is found\n        console.log('Database query result:', {\n            data,\n            error\n        });\n        if (error) {\n            console.error('Error querying user:', error);\n            throw new Error('Database error during authentication');\n        }\n        if (!data) {\n            console.log('No user found with this email');\n            throw new Error('No user found with this email');\n        }\n        // Vérifier le mot de passe\n        console.log('Comparing passwords...');\n        const passwordMatch = await (0,bcrypt__WEBPACK_IMPORTED_MODULE_0__.compare)(password, data.password);\n        console.log('Password match result:', passwordMatch);\n        if (!passwordMatch) {\n            throw new Error('Invalid credentials');\n        }\n        // Retourner les informations de l'utilisateur sans le mot de passe\n        console.log('Authentication successful for user:', data.email);\n        return {\n            id: data.id,\n            email: data.email,\n            name: data.name,\n            image: data.avatar\n        };\n    } catch (error) {\n        console.error('Authentication error:', error);\n        if (error instanceof Error) {\n            throw error; // Propager l'erreur avec le message spécifique\n        }\n        throw new Error('Authentication failed');\n    }\n}\n/**\n * Trouve ou crée un utilisateur à partir d'un profil OAuth (GitHub, Google, etc.)\n */ async function findOrCreateOAuthUser(profile, provider) {\n    try {\n        console.log('Profil OAuth reçu:', JSON.stringify(profile, null, 2));\n        console.log('Fournisseur:', provider);\n        // Vérifier que le profil contient un email\n        if (!profile.email) {\n            console.error('Profil OAuth sans email:', JSON.stringify(profile, null, 2));\n            throw new Error('Le profil OAuth ne contient pas d\\'email');\n        }\n        // Extraire les informations du profil en fonction du fournisseur\n        let userId = profile.id || profile.sub;\n        let userName = profile.name;\n        let userImage = profile.image || profile.picture || profile.avatar_url;\n        // Traitement spécifique pour Google\n        if (provider === 'google') {\n            // Pour Google, l'ID est généralement dans profile.sub\n            userId = profile.sub || userId;\n            // Google fournit souvent le nom dans des propriétés séparées\n            if (profile.given_name && profile.family_name) {\n                userName = `${profile.given_name} ${profile.family_name}`;\n            }\n            // Google fournit l'image dans profile.picture\n            userImage = profile.picture || userImage;\n            console.log('Informations extraites pour Google:', {\n                userId,\n                userName,\n                userImage,\n                email: profile.email\n            });\n        }\n        // Traitement spécifique pour GitHub\n        if (provider === 'github') {\n            // GitHub fournit l'ID dans profile.id\n            userId = profile.id || userId;\n            // GitHub fournit l'image dans profile.avatar_url\n            userImage = profile.avatar_url || userImage;\n            console.log('Informations extraites pour GitHub:', {\n                userId,\n                userName,\n                userImage,\n                email: profile.email\n            });\n        }\n        if (!userId) {\n            console.error('Aucun ID utilisateur trouvé dans le profil OAuth');\n            throw new Error('Aucun ID utilisateur trouvé dans le profil OAuth');\n        }\n        // D'abord, essayons de trouver l'utilisateur par ID\n        const { data: existingUserById, error: idSearchError } = await supabase.from('users').select('id, email, name, avatar').eq('id', userId).maybeSingle();\n        if (idSearchError) {\n            console.error('Erreur lors de la recherche de l\\'utilisateur par ID:', idSearchError);\n        }\n        // Si l'utilisateur existe par ID, le retourner immédiatement\n        if (existingUserById) {\n            console.log('Utilisateur existant trouvé par ID:', existingUserById);\n            return {\n                id: existingUserById.id,\n                email: existingUserById.email,\n                name: existingUserById.name,\n                image: existingUserById.avatar\n            };\n        }\n        // Ensuite, essayons de trouver l'utilisateur par email\n        const { data: existingUserByEmail, error: emailSearchError } = await supabase.from('users').select('id, email, name, avatar').eq('email', profile.email).maybeSingle();\n        if (emailSearchError) {\n            console.error('Erreur lors de la recherche de l\\'utilisateur par email:', emailSearchError);\n        }\n        // Si l'utilisateur existe par email, mettons à jour son ID pour correspondre à l'ID OAuth\n        if (existingUserByEmail) {\n            console.log('Utilisateur existant trouvé par email:', existingUserByEmail);\n            console.log('Mise à jour de l\\'ID utilisateur pour correspondre à l\\'ID OAuth:', userId);\n            const { data: updatedUser, error: updateError } = await supabase.from('users').update({\n                id: userId,\n                name: userName || existingUserByEmail.name,\n                avatar: userImage || existingUserByEmail.avatar\n            }).eq('id', existingUserByEmail.id).select('id, email, name, avatar').single();\n            if (updateError) {\n                console.error('Erreur lors de la mise à jour de l\\'ID utilisateur:', updateError);\n                // Si l'erreur est liée à une contrainte de clé unique, cela signifie probablement\n                // qu'un autre utilisateur avec cet ID existe déjà.\n                // Dans ce cas, utilisons l'ID existant au lieu d'essayer de le mettre à jour\n                if (updateError.code === '23505') {\n                    console.log('Un autre utilisateur existe avec cet ID OAuth, utilisation de l\\'utilisateur existant');\n                    return {\n                        id: existingUserByEmail.id,\n                        email: existingUserByEmail.email,\n                        name: existingUserByEmail.name,\n                        image: existingUserByEmail.avatar\n                    };\n                }\n                throw updateError;\n            }\n            console.log('ID utilisateur mis à jour avec l\\'ID OAuth:', updatedUser);\n            return {\n                id: updatedUser.id,\n                email: updatedUser.email,\n                name: updatedUser.name,\n                image: updatedUser.avatar\n            };\n        }\n        // Si l'utilisateur n'existe pas du tout, créons-le\n        console.log('Création d\\'un nouvel utilisateur OAuth avec les données:', {\n            id: userId,\n            email: profile.email,\n            name: userName,\n            avatar: userImage,\n            provider\n        });\n        const { data: newUser, error: createError } = await supabase.from('users').insert({\n            id: userId,\n            email: profile.email,\n            name: userName || `${provider} User`,\n            avatar: userImage || null,\n            password: null,\n            is_active: true\n        }).select('id, email, name, avatar').single();\n        if (createError) {\n            console.error('Erreur lors de la création de l\\'utilisateur:', createError);\n            throw createError;\n        }\n        console.log('Nouvel utilisateur créé avec succès:', newUser);\n        return {\n            id: newUser.id,\n            email: newUser.email,\n            name: newUser.name,\n            image: newUser.avatar\n        };\n    } catch (error) {\n        console.error('Erreur dans findOrCreateOAuthUser:', error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9kYi1xdWVyaWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQWlDO0FBQ29CO0FBRXJELDJCQUEyQjtBQUMzQixNQUFNRSxjQUFjQywwQ0FBb0MsSUFBSSxDQUFFO0FBQzlELE1BQU1HLGNBQWNILGtOQUF5QyxJQUFJLENBQUU7QUFDbkUsTUFBTUssV0FBV1AsbUVBQVlBLENBQUNDLGFBQWFJO0FBRTNDOztDQUVDLEdBQ00sZUFBZUcsc0JBQXNCQyxLQUFhLEVBQUVDLFFBQWdCO0lBQ3pFLElBQUk7UUFDRkMsUUFBUUMsR0FBRyxDQUFDLENBQUMsNENBQTRDLEVBQUVILE9BQU87UUFFbEUscUNBQXFDO1FBQ3JDLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNUCxTQUMzQlEsSUFBSSxDQUFDLFNBQ0xDLE1BQU0sQ0FBQyxxQ0FDUEMsRUFBRSxDQUFDLFNBQVNSLE9BQ1pTLFdBQVcsSUFBSSw0RUFBNEU7UUFFOUZQLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEI7WUFBRUM7WUFBTUM7UUFBTTtRQUVwRCxJQUFJQSxPQUFPO1lBQ1RILFFBQVFHLEtBQUssQ0FBQyx3QkFBd0JBO1lBQ3RDLE1BQU0sSUFBSUssTUFBTTtRQUNsQjtRQUVBLElBQUksQ0FBQ04sTUFBTTtZQUNURixRQUFRQyxHQUFHLENBQUM7WUFDWixNQUFNLElBQUlPLE1BQU07UUFDbEI7UUFFQSwyQkFBMkI7UUFDM0JSLFFBQVFDLEdBQUcsQ0FBQztRQUNaLE1BQU1RLGdCQUFnQixNQUFNckIsK0NBQU9BLENBQUNXLFVBQVVHLEtBQUtILFFBQVE7UUFDM0RDLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEJRO1FBRXRDLElBQUksQ0FBQ0EsZUFBZTtZQUNsQixNQUFNLElBQUlELE1BQU07UUFDbEI7UUFFQSxtRUFBbUU7UUFDbkVSLFFBQVFDLEdBQUcsQ0FBQyx1Q0FBdUNDLEtBQUtKLEtBQUs7UUFDN0QsT0FBTztZQUNMWSxJQUFJUixLQUFLUSxFQUFFO1lBQ1haLE9BQU9JLEtBQUtKLEtBQUs7WUFDakJhLE1BQU1ULEtBQUtTLElBQUk7WUFDZkMsT0FBT1YsS0FBS1csTUFBTTtRQUNwQjtJQUNGLEVBQUUsT0FBT1YsT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMseUJBQXlCQTtRQUN2QyxJQUFJQSxpQkFBaUJLLE9BQU87WUFDMUIsTUFBTUwsT0FBTywrQ0FBK0M7UUFDOUQ7UUFDQSxNQUFNLElBQUlLLE1BQU07SUFDbEI7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZU0sc0JBQXNCQyxPQUFZLEVBQUVDLFFBQWdCO0lBQ3hFLElBQUk7UUFDRmhCLFFBQVFDLEdBQUcsQ0FBQyxzQkFBc0JnQixLQUFLQyxTQUFTLENBQUNILFNBQVMsTUFBTTtRQUNoRWYsUUFBUUMsR0FBRyxDQUFDLGdCQUFnQmU7UUFFNUIsMkNBQTJDO1FBQzNDLElBQUksQ0FBQ0QsUUFBUWpCLEtBQUssRUFBRTtZQUNsQkUsUUFBUUcsS0FBSyxDQUFDLDRCQUE0QmMsS0FBS0MsU0FBUyxDQUFDSCxTQUFTLE1BQU07WUFDeEUsTUFBTSxJQUFJUCxNQUFNO1FBQ2xCO1FBRUEsaUVBQWlFO1FBQ2pFLElBQUlXLFNBQVNKLFFBQVFMLEVBQUUsSUFBSUssUUFBUUssR0FBRztRQUN0QyxJQUFJQyxXQUFXTixRQUFRSixJQUFJO1FBQzNCLElBQUlXLFlBQVlQLFFBQVFILEtBQUssSUFBSUcsUUFBUVEsT0FBTyxJQUFJUixRQUFRUyxVQUFVO1FBRXRFLG9DQUFvQztRQUNwQyxJQUFJUixhQUFhLFVBQVU7WUFDekIsc0RBQXNEO1lBQ3RERyxTQUFTSixRQUFRSyxHQUFHLElBQUlEO1lBQ3hCLDZEQUE2RDtZQUM3RCxJQUFJSixRQUFRVSxVQUFVLElBQUlWLFFBQVFXLFdBQVcsRUFBRTtnQkFDN0NMLFdBQVcsR0FBR04sUUFBUVUsVUFBVSxDQUFDLENBQUMsRUFBRVYsUUFBUVcsV0FBVyxFQUFFO1lBQzNEO1lBQ0EsOENBQThDO1lBQzlDSixZQUFZUCxRQUFRUSxPQUFPLElBQUlEO1lBQy9CdEIsUUFBUUMsR0FBRyxDQUFDLHVDQUF1QztnQkFBRWtCO2dCQUFRRTtnQkFBVUM7Z0JBQVd4QixPQUFPaUIsUUFBUWpCLEtBQUs7WUFBQztRQUN6RztRQUVBLG9DQUFvQztRQUNwQyxJQUFJa0IsYUFBYSxVQUFVO1lBQ3pCLHNDQUFzQztZQUN0Q0csU0FBU0osUUFBUUwsRUFBRSxJQUFJUztZQUN2QixpREFBaUQ7WUFDakRHLFlBQVlQLFFBQVFTLFVBQVUsSUFBSUY7WUFDbEN0QixRQUFRQyxHQUFHLENBQUMsdUNBQXVDO2dCQUFFa0I7Z0JBQVFFO2dCQUFVQztnQkFBV3hCLE9BQU9pQixRQUFRakIsS0FBSztZQUFDO1FBQ3pHO1FBRUEsSUFBSSxDQUFDcUIsUUFBUTtZQUNYbkIsUUFBUUcsS0FBSyxDQUFDO1lBQ2QsTUFBTSxJQUFJSyxNQUFNO1FBQ2xCO1FBRUEsb0RBQW9EO1FBQ3BELE1BQU0sRUFBRU4sTUFBTXlCLGdCQUFnQixFQUFFeEIsT0FBT3lCLGFBQWEsRUFBRSxHQUFHLE1BQU1oQyxTQUM1RFEsSUFBSSxDQUFDLFNBQ0xDLE1BQU0sQ0FBQywyQkFDUEMsRUFBRSxDQUFDLE1BQU1hLFFBQ1RaLFdBQVc7UUFFZCxJQUFJcUIsZUFBZTtZQUNqQjVCLFFBQVFHLEtBQUssQ0FBQyx5REFBeUR5QjtRQUN6RTtRQUVBLDZEQUE2RDtRQUM3RCxJQUFJRCxrQkFBa0I7WUFDcEIzQixRQUFRQyxHQUFHLENBQUMsdUNBQXVDMEI7WUFDbkQsT0FBTztnQkFDTGpCLElBQUlpQixpQkFBaUJqQixFQUFFO2dCQUN2QlosT0FBTzZCLGlCQUFpQjdCLEtBQUs7Z0JBQzdCYSxNQUFNZ0IsaUJBQWlCaEIsSUFBSTtnQkFDM0JDLE9BQU9lLGlCQUFpQmQsTUFBTTtZQUNoQztRQUNGO1FBRUEsdURBQXVEO1FBQ3ZELE1BQU0sRUFBRVgsTUFBTTJCLG1CQUFtQixFQUFFMUIsT0FBTzJCLGdCQUFnQixFQUFFLEdBQUcsTUFBTWxDLFNBQ2xFUSxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLDJCQUNQQyxFQUFFLENBQUMsU0FBU1MsUUFBUWpCLEtBQUssRUFDekJTLFdBQVc7UUFFZCxJQUFJdUIsa0JBQWtCO1lBQ3BCOUIsUUFBUUcsS0FBSyxDQUFDLDREQUE0RDJCO1FBQzVFO1FBRUEsMEZBQTBGO1FBQzFGLElBQUlELHFCQUFxQjtZQUN2QjdCLFFBQVFDLEdBQUcsQ0FBQywwQ0FBMEM0QjtZQUN0RDdCLFFBQVFDLEdBQUcsQ0FBQyxxRUFBcUVrQjtZQUVqRixNQUFNLEVBQUVqQixNQUFNNkIsV0FBVyxFQUFFNUIsT0FBTzZCLFdBQVcsRUFBRSxHQUFHLE1BQU1wQyxTQUNyRFEsSUFBSSxDQUFDLFNBQ0w2QixNQUFNLENBQUM7Z0JBQ052QixJQUFJUztnQkFDSlIsTUFBTVUsWUFBWVEsb0JBQW9CbEIsSUFBSTtnQkFDMUNFLFFBQVFTLGFBQWFPLG9CQUFvQmhCLE1BQU07WUFDakQsR0FDQ1AsRUFBRSxDQUFDLE1BQU11QixvQkFBb0JuQixFQUFFLEVBQy9CTCxNQUFNLENBQUMsMkJBQ1A2QixNQUFNO1lBRVQsSUFBSUYsYUFBYTtnQkFDZmhDLFFBQVFHLEtBQUssQ0FBQyx1REFBdUQ2QjtnQkFFckUsa0ZBQWtGO2dCQUNsRixtREFBbUQ7Z0JBQ25ELDZFQUE2RTtnQkFDN0UsSUFBSUEsWUFBWUcsSUFBSSxLQUFLLFNBQVM7b0JBQ2hDbkMsUUFBUUMsR0FBRyxDQUFDO29CQUNaLE9BQU87d0JBQ0xTLElBQUltQixvQkFBb0JuQixFQUFFO3dCQUMxQlosT0FBTytCLG9CQUFvQi9CLEtBQUs7d0JBQ2hDYSxNQUFNa0Isb0JBQW9CbEIsSUFBSTt3QkFDOUJDLE9BQU9pQixvQkFBb0JoQixNQUFNO29CQUNuQztnQkFDRjtnQkFFQSxNQUFNbUI7WUFDUjtZQUVBaEMsUUFBUUMsR0FBRyxDQUFDLCtDQUErQzhCO1lBQzNELE9BQU87Z0JBQ0xyQixJQUFJcUIsWUFBWXJCLEVBQUU7Z0JBQ2xCWixPQUFPaUMsWUFBWWpDLEtBQUs7Z0JBQ3hCYSxNQUFNb0IsWUFBWXBCLElBQUk7Z0JBQ3RCQyxPQUFPbUIsWUFBWWxCLE1BQU07WUFDM0I7UUFDRjtRQUVBLG1EQUFtRDtRQUNuRGIsUUFBUUMsR0FBRyxDQUFDLDZEQUE2RDtZQUN2RVMsSUFBSVM7WUFDSnJCLE9BQU9pQixRQUFRakIsS0FBSztZQUNwQmEsTUFBTVU7WUFDTlIsUUFBUVM7WUFDUk47UUFDRjtRQUVBLE1BQU0sRUFBRWQsTUFBTWtDLE9BQU8sRUFBRWpDLE9BQU9rQyxXQUFXLEVBQUUsR0FBRyxNQUFNekMsU0FDakRRLElBQUksQ0FBQyxTQUNMa0MsTUFBTSxDQUFDO1lBQ041QixJQUFJUztZQUNKckIsT0FBT2lCLFFBQVFqQixLQUFLO1lBQ3BCYSxNQUFNVSxZQUFZLEdBQUdMLFNBQVMsS0FBSyxDQUFDO1lBQ3BDSCxRQUFRUyxhQUFhO1lBQ3JCdkIsVUFBVTtZQUNWd0MsV0FBVztRQUNiLEdBQ0NsQyxNQUFNLENBQUMsMkJBQ1A2QixNQUFNO1FBRVQsSUFBSUcsYUFBYTtZQUNmckMsUUFBUUcsS0FBSyxDQUFDLGlEQUFpRGtDO1lBQy9ELE1BQU1BO1FBQ1I7UUFFQXJDLFFBQVFDLEdBQUcsQ0FBQyx3Q0FBd0NtQztRQUNwRCxPQUFPO1lBQ0wxQixJQUFJMEIsUUFBUTFCLEVBQUU7WUFDZFosT0FBT3NDLFFBQVF0QyxLQUFLO1lBQ3BCYSxNQUFNeUIsUUFBUXpCLElBQUk7WUFDbEJDLE9BQU93QixRQUFRdkIsTUFBTTtRQUN2QjtJQUNGLEVBQUUsT0FBT1YsT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsc0NBQXNDQTtRQUNwRCxNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaGFybGVzLWhlbnJ5bm9haC9EZXNrdG9wL3Zpemlvbi9WaXppb24vbGliL2F1dGgvZGItcXVlcmllcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb21wYXJlIH0gZnJvbSAnYmNyeXB0JztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8vIENyw6llciBsZSBjbGllbnQgU3VwYWJhc2VcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICcnO1xuY29uc3Qgc3VwYWJhc2VLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCAnJztcbmNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUtleSk7XG5cbi8qKlxuICogVsOpcmlmaWUgbGVzIGlkZW50aWZpYW50cyBkZSBsJ3V0aWxpc2F0ZXVyIHBvdXIgbCdhdXRoZW50aWZpY2F0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlVc2VyQ3JlZGVudGlhbHMoZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBBdHRlbXB0aW5nIHRvIHZlcmlmeSBjcmVkZW50aWFscyBmb3IgZW1haWw6ICR7ZW1haWx9YCk7XG4gICAgXG4gICAgLy8gUmVjaGVyY2hlciBsJ3V0aWxpc2F0ZXVyIHBhciBlbWFpbFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCBwYXNzd29yZCwgYXZhdGFyJylcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcbiAgICAgIC5tYXliZVNpbmdsZSgpOyAvLyBVc2luZyBtYXliZVNpbmdsZSBpbnN0ZWFkIG9mIHNpbmdsZSB0byBhdm9pZCBlcnJvcnMgd2hlbiBubyB1c2VyIGlzIGZvdW5kXG4gICAgXG4gICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIHF1ZXJ5IHJlc3VsdDonLCB7IGRhdGEsIGVycm9yIH0pO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBxdWVyeWluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3IgZHVyaW5nIGF1dGhlbnRpY2F0aW9uJyk7XG4gICAgfVxuXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICBjb25zb2xlLmxvZygnTm8gdXNlciBmb3VuZCB3aXRoIHRoaXMgZW1haWwnKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdXNlciBmb3VuZCB3aXRoIHRoaXMgZW1haWwnKTtcbiAgICB9XG5cbiAgICAvLyBWw6lyaWZpZXIgbGUgbW90IGRlIHBhc3NlXG4gICAgY29uc29sZS5sb2coJ0NvbXBhcmluZyBwYXNzd29yZHMuLi4nKTtcbiAgICBjb25zdCBwYXNzd29yZE1hdGNoID0gYXdhaXQgY29tcGFyZShwYXNzd29yZCwgZGF0YS5wYXNzd29yZCk7XG4gICAgY29uc29sZS5sb2coJ1Bhc3N3b3JkIG1hdGNoIHJlc3VsdDonLCBwYXNzd29yZE1hdGNoKTtcbiAgICBcbiAgICBpZiAoIXBhc3N3b3JkTWF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgIH1cblxuICAgIC8vIFJldG91cm5lciBsZXMgaW5mb3JtYXRpb25zIGRlIGwndXRpbGlzYXRldXIgc2FucyBsZSBtb3QgZGUgcGFzc2VcbiAgICBjb25zb2xlLmxvZygnQXV0aGVudGljYXRpb24gc3VjY2Vzc2Z1bCBmb3IgdXNlcjonLCBkYXRhLmVtYWlsKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGRhdGEuaWQsXG4gICAgICBlbWFpbDogZGF0YS5lbWFpbCxcbiAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgIGltYWdlOiBkYXRhLmF2YXRhclxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQXV0aGVudGljYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjsgLy8gUHJvcGFnZXIgbCdlcnJldXIgYXZlYyBsZSBtZXNzYWdlIHNww6ljaWZpcXVlXG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gZmFpbGVkJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBUcm91dmUgb3UgY3LDqWUgdW4gdXRpbGlzYXRldXIgw6AgcGFydGlyIGQndW4gcHJvZmlsIE9BdXRoIChHaXRIdWIsIEdvb2dsZSwgZXRjLilcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRPckNyZWF0ZU9BdXRoVXNlcihwcm9maWxlOiBhbnksIHByb3ZpZGVyOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnUHJvZmlsIE9BdXRoIHJlw6d1OicsIEpTT04uc3RyaW5naWZ5KHByb2ZpbGUsIG51bGwsIDIpKTtcbiAgICBjb25zb2xlLmxvZygnRm91cm5pc3NldXI6JywgcHJvdmlkZXIpO1xuICAgIFxuICAgIC8vIFbDqXJpZmllciBxdWUgbGUgcHJvZmlsIGNvbnRpZW50IHVuIGVtYWlsXG4gICAgaWYgKCFwcm9maWxlLmVtYWlsKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQcm9maWwgT0F1dGggc2FucyBlbWFpbDonLCBKU09OLnN0cmluZ2lmeShwcm9maWxlLCBudWxsLCAyKSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xlIHByb2ZpbCBPQXV0aCBuZSBjb250aWVudCBwYXMgZFxcJ2VtYWlsJyk7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFpcmUgbGVzIGluZm9ybWF0aW9ucyBkdSBwcm9maWwgZW4gZm9uY3Rpb24gZHUgZm91cm5pc3NldXJcbiAgICBsZXQgdXNlcklkID0gcHJvZmlsZS5pZCB8fCBwcm9maWxlLnN1YjtcbiAgICBsZXQgdXNlck5hbWUgPSBwcm9maWxlLm5hbWU7XG4gICAgbGV0IHVzZXJJbWFnZSA9IHByb2ZpbGUuaW1hZ2UgfHwgcHJvZmlsZS5waWN0dXJlIHx8IHByb2ZpbGUuYXZhdGFyX3VybDtcbiAgICBcbiAgICAvLyBUcmFpdGVtZW50IHNww6ljaWZpcXVlIHBvdXIgR29vZ2xlXG4gICAgaWYgKHByb3ZpZGVyID09PSAnZ29vZ2xlJykge1xuICAgICAgLy8gUG91ciBHb29nbGUsIGwnSUQgZXN0IGfDqW7DqXJhbGVtZW50IGRhbnMgcHJvZmlsZS5zdWJcbiAgICAgIHVzZXJJZCA9IHByb2ZpbGUuc3ViIHx8IHVzZXJJZDtcbiAgICAgIC8vIEdvb2dsZSBmb3Vybml0IHNvdXZlbnQgbGUgbm9tIGRhbnMgZGVzIHByb3ByacOpdMOpcyBzw6lwYXLDqWVzXG4gICAgICBpZiAocHJvZmlsZS5naXZlbl9uYW1lICYmIHByb2ZpbGUuZmFtaWx5X25hbWUpIHtcbiAgICAgICAgdXNlck5hbWUgPSBgJHtwcm9maWxlLmdpdmVuX25hbWV9ICR7cHJvZmlsZS5mYW1pbHlfbmFtZX1gO1xuICAgICAgfVxuICAgICAgLy8gR29vZ2xlIGZvdXJuaXQgbCdpbWFnZSBkYW5zIHByb2ZpbGUucGljdHVyZVxuICAgICAgdXNlckltYWdlID0gcHJvZmlsZS5waWN0dXJlIHx8IHVzZXJJbWFnZTtcbiAgICAgIGNvbnNvbGUubG9nKCdJbmZvcm1hdGlvbnMgZXh0cmFpdGVzIHBvdXIgR29vZ2xlOicsIHsgdXNlcklkLCB1c2VyTmFtZSwgdXNlckltYWdlLCBlbWFpbDogcHJvZmlsZS5lbWFpbCB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJhaXRlbWVudCBzcMOpY2lmaXF1ZSBwb3VyIEdpdEh1YlxuICAgIGlmIChwcm92aWRlciA9PT0gJ2dpdGh1YicpIHtcbiAgICAgIC8vIEdpdEh1YiBmb3Vybml0IGwnSUQgZGFucyBwcm9maWxlLmlkXG4gICAgICB1c2VySWQgPSBwcm9maWxlLmlkIHx8IHVzZXJJZDtcbiAgICAgIC8vIEdpdEh1YiBmb3Vybml0IGwnaW1hZ2UgZGFucyBwcm9maWxlLmF2YXRhcl91cmxcbiAgICAgIHVzZXJJbWFnZSA9IHByb2ZpbGUuYXZhdGFyX3VybCB8fCB1c2VySW1hZ2U7XG4gICAgICBjb25zb2xlLmxvZygnSW5mb3JtYXRpb25zIGV4dHJhaXRlcyBwb3VyIEdpdEh1YjonLCB7IHVzZXJJZCwgdXNlck5hbWUsIHVzZXJJbWFnZSwgZW1haWw6IHByb2ZpbGUuZW1haWwgfSk7XG4gICAgfVxuXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1Y3VuIElEIHV0aWxpc2F0ZXVyIHRyb3V2w6kgZGFucyBsZSBwcm9maWwgT0F1dGgnKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXVjdW4gSUQgdXRpbGlzYXRldXIgdHJvdXbDqSBkYW5zIGxlIHByb2ZpbCBPQXV0aCcpO1xuICAgIH1cblxuICAgIC8vIEQnYWJvcmQsIGVzc2F5b25zIGRlIHRyb3V2ZXIgbCd1dGlsaXNhdGV1ciBwYXIgSURcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nVXNlckJ5SWQsIGVycm9yOiBpZFNlYXJjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgYXZhdGFyJylcbiAgICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgICAubWF5YmVTaW5nbGUoKTtcblxuICAgIGlmIChpZFNlYXJjaEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgbG9ycyBkZSBsYSByZWNoZXJjaGUgZGUgbFxcJ3V0aWxpc2F0ZXVyIHBhciBJRDonLCBpZFNlYXJjaEVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBTaSBsJ3V0aWxpc2F0ZXVyIGV4aXN0ZSBwYXIgSUQsIGxlIHJldG91cm5lciBpbW3DqWRpYXRlbWVudFxuICAgIGlmIChleGlzdGluZ1VzZXJCeUlkKSB7XG4gICAgICBjb25zb2xlLmxvZygnVXRpbGlzYXRldXIgZXhpc3RhbnQgdHJvdXbDqSBwYXIgSUQ6JywgZXhpc3RpbmdVc2VyQnlJZCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogZXhpc3RpbmdVc2VyQnlJZC5pZCxcbiAgICAgICAgZW1haWw6IGV4aXN0aW5nVXNlckJ5SWQuZW1haWwsXG4gICAgICAgIG5hbWU6IGV4aXN0aW5nVXNlckJ5SWQubmFtZSxcbiAgICAgICAgaW1hZ2U6IGV4aXN0aW5nVXNlckJ5SWQuYXZhdGFyXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEVuc3VpdGUsIGVzc2F5b25zIGRlIHRyb3V2ZXIgbCd1dGlsaXNhdGV1ciBwYXIgZW1haWxcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nVXNlckJ5RW1haWwsIGVycm9yOiBlbWFpbFNlYXJjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgYXZhdGFyJylcbiAgICAgIC5lcSgnZW1haWwnLCBwcm9maWxlLmVtYWlsKVxuICAgICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgICBpZiAoZW1haWxTZWFyY2hFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyIGxvcnMgZGUgbGEgcmVjaGVyY2hlIGRlIGxcXCd1dGlsaXNhdGV1ciBwYXIgZW1haWw6JywgZW1haWxTZWFyY2hFcnJvcik7XG4gICAgfVxuXG4gICAgLy8gU2kgbCd1dGlsaXNhdGV1ciBleGlzdGUgcGFyIGVtYWlsLCBtZXR0b25zIMOgIGpvdXIgc29uIElEIHBvdXIgY29ycmVzcG9uZHJlIMOgIGwnSUQgT0F1dGhcbiAgICBpZiAoZXhpc3RpbmdVc2VyQnlFbWFpbCkge1xuICAgICAgY29uc29sZS5sb2coJ1V0aWxpc2F0ZXVyIGV4aXN0YW50IHRyb3V2w6kgcGFyIGVtYWlsOicsIGV4aXN0aW5nVXNlckJ5RW1haWwpO1xuICAgICAgY29uc29sZS5sb2coJ01pc2Ugw6Agam91ciBkZSBsXFwnSUQgdXRpbGlzYXRldXIgcG91ciBjb3JyZXNwb25kcmUgw6AgbFxcJ0lEIE9BdXRoOicsIHVzZXJJZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFVzZXIsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgLnVwZGF0ZSh7XG4gICAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgICBuYW1lOiB1c2VyTmFtZSB8fCBleGlzdGluZ1VzZXJCeUVtYWlsLm5hbWUsXG4gICAgICAgICAgYXZhdGFyOiB1c2VySW1hZ2UgfHwgZXhpc3RpbmdVc2VyQnlFbWFpbC5hdmF0YXJcbiAgICAgICAgfSlcbiAgICAgICAgLmVxKCdpZCcsIGV4aXN0aW5nVXNlckJ5RW1haWwuaWQpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgYXZhdGFyJylcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgICBcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgbG9ycyBkZSBsYSBtaXNlIMOgIGpvdXIgZGUgbFxcJ0lEIHV0aWxpc2F0ZXVyOicsIHVwZGF0ZUVycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNpIGwnZXJyZXVyIGVzdCBsacOpZSDDoCB1bmUgY29udHJhaW50ZSBkZSBjbMOpIHVuaXF1ZSwgY2VsYSBzaWduaWZpZSBwcm9iYWJsZW1lbnRcbiAgICAgICAgLy8gcXUndW4gYXV0cmUgdXRpbGlzYXRldXIgYXZlYyBjZXQgSUQgZXhpc3RlIGTDqWrDoC5cbiAgICAgICAgLy8gRGFucyBjZSBjYXMsIHV0aWxpc29ucyBsJ0lEIGV4aXN0YW50IGF1IGxpZXUgZCdlc3NheWVyIGRlIGxlIG1ldHRyZSDDoCBqb3VyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1VuIGF1dHJlIHV0aWxpc2F0ZXVyIGV4aXN0ZSBhdmVjIGNldCBJRCBPQXV0aCwgdXRpbGlzYXRpb24gZGUgbFxcJ3V0aWxpc2F0ZXVyIGV4aXN0YW50Jyk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBleGlzdGluZ1VzZXJCeUVtYWlsLmlkLFxuICAgICAgICAgICAgZW1haWw6IGV4aXN0aW5nVXNlckJ5RW1haWwuZW1haWwsXG4gICAgICAgICAgICBuYW1lOiBleGlzdGluZ1VzZXJCeUVtYWlsLm5hbWUsXG4gICAgICAgICAgICBpbWFnZTogZXhpc3RpbmdVc2VyQnlFbWFpbC5hdmF0YXJcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aHJvdyB1cGRhdGVFcnJvcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0lEIHV0aWxpc2F0ZXVyIG1pcyDDoCBqb3VyIGF2ZWMgbFxcJ0lEIE9BdXRoOicsIHVwZGF0ZWRVc2VyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiB1cGRhdGVkVXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVwZGF0ZWRVc2VyLmVtYWlsLFxuICAgICAgICBuYW1lOiB1cGRhdGVkVXNlci5uYW1lLFxuICAgICAgICBpbWFnZTogdXBkYXRlZFVzZXIuYXZhdGFyXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFNpIGwndXRpbGlzYXRldXIgbidleGlzdGUgcGFzIGR1IHRvdXQsIGNyw6lvbnMtbGVcbiAgICBjb25zb2xlLmxvZygnQ3LDqWF0aW9uIGRcXCd1biBub3V2ZWwgdXRpbGlzYXRldXIgT0F1dGggYXZlYyBsZXMgZG9ubsOpZXM6Jywge1xuICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgbmFtZTogdXNlck5hbWUsXG4gICAgICBhdmF0YXI6IHVzZXJJbWFnZSxcbiAgICAgIHByb3ZpZGVyXG4gICAgfSk7XG5cbiAgICBjb25zdCB7IGRhdGE6IG5ld1VzZXIsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXJOYW1lIHx8IGAke3Byb3ZpZGVyfSBVc2VyYCxcbiAgICAgICAgYXZhdGFyOiB1c2VySW1hZ2UgfHwgbnVsbCxcbiAgICAgICAgcGFzc3dvcmQ6IG51bGwsXG4gICAgICAgIGlzX2FjdGl2ZTogdHJ1ZVxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgYXZhdGFyJylcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChjcmVhdGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyIGxvcnMgZGUgbGEgY3LDqWF0aW9uIGRlIGxcXCd1dGlsaXNhdGV1cjonLCBjcmVhdGVFcnJvcik7XG4gICAgICB0aHJvdyBjcmVhdGVFcnJvcjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnTm91dmVsIHV0aWxpc2F0ZXVyIGNyw6nDqSBhdmVjIHN1Y2PDqHM6JywgbmV3VXNlcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBuZXdVc2VyLmlkLFxuICAgICAgZW1haWw6IG5ld1VzZXIuZW1haWwsXG4gICAgICBuYW1lOiBuZXdVc2VyLm5hbWUsXG4gICAgICBpbWFnZTogbmV3VXNlci5hdmF0YXJcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBkYW5zIGZpbmRPckNyZWF0ZU9BdXRoVXNlcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn0iXSwibmFtZXMiOlsiY29tcGFyZSIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZSIsInZlcmlmeVVzZXJDcmVkZW50aWFscyIsImVtYWlsIiwicGFzc3dvcmQiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJFcnJvciIsInBhc3N3b3JkTWF0Y2giLCJpZCIsIm5hbWUiLCJpbWFnZSIsImF2YXRhciIsImZpbmRPckNyZWF0ZU9BdXRoVXNlciIsInByb2ZpbGUiLCJwcm92aWRlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1c2VySWQiLCJzdWIiLCJ1c2VyTmFtZSIsInVzZXJJbWFnZSIsInBpY3R1cmUiLCJhdmF0YXJfdXJsIiwiZ2l2ZW5fbmFtZSIsImZhbWlseV9uYW1lIiwiZXhpc3RpbmdVc2VyQnlJZCIsImlkU2VhcmNoRXJyb3IiLCJleGlzdGluZ1VzZXJCeUVtYWlsIiwiZW1haWxTZWFyY2hFcnJvciIsInVwZGF0ZWRVc2VyIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJzaW5nbGUiLCJjb2RlIiwibmV3VXNlciIsImNyZWF0ZUVycm9yIiwiaW5zZXJ0IiwiaXNfYWN0aXZlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/db-queries.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var drizzle_orm_postgres_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm/postgres-js */ \"(rsc)/./node_modules/drizzle-orm/postgres-js/driver.js\");\n/* harmony import */ var postgres__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! postgres */ \"(rsc)/./node_modules/postgres/src/index.js\");\n\n\n\n// Read Supabase credentials from environment variables\nconst supabaseUrl = \"https://ffwfdogonvgzudzsdcri.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2Zkb2dvbnZnenVkenNkY3JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMzMTg1MDQsImV4cCI6MjA1ODg5NDUwNH0.dfUnoBwD56sgNINPI-tLAuaMJ7PuGPuQanAJ_YrwOGI\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_KEY;\n// Basic check to ensure environment variables are set\nif (!supabaseUrl) {\n    throw new Error(\"Supabase URL not found. Make sure NEXT_PUBLIC_SUPABASE_URL is set in your .env file.\");\n}\nif (!supabaseAnonKey) {\n    throw new Error(\"Supabase Anon Key not found. Make sure NEXT_PUBLIC_SUPABASE_ANON_KEY is set in your .env file.\");\n}\n// Create and export the Supabase client instance with anonymous key (for client-side)\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n// Create a Supabase client with service role key for server-side operations that need elevated privileges\nconst supabaseAdmin = supabaseServiceKey ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey) : supabase;\n// Configuration pour Drizzle ORM avec PostgreSQL\nlet db;\n// Fonction pour configurer Drizzle\nfunction setupDrizzle() {\n    const databaseUrl = process.env.DATABASE_URL;\n    if (!databaseUrl) {\n        console.error(\"DATABASE_URL is not defined in environment variables\");\n        throw new Error(\"DATABASE_URL is not defined in environment variables\");\n    }\n    try {\n        // Créer un client PostgreSQL avec des options de connexion robustes\n        const client = (0,postgres__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(databaseUrl, {\n            max: 10,\n            idle_timeout: 20,\n            connect_timeout: 30,\n            prepare: false\n        });\n        // Créer une instance Drizzle\n        return (0,drizzle_orm_postgres_js__WEBPACK_IMPORTED_MODULE_2__.drizzle)(client);\n    } catch (error) {\n        console.error(\"Erreur lors de la configuration de Drizzle:\", error);\n        throw error;\n    }\n}\n// Initialiser Drizzle en environnement serveur uniquement\nif (true) {\n    try {\n        db = setupDrizzle();\n    } catch (error) {\n        console.error(\"Erreur lors de l'initialisation de Drizzle:\", error);\n        // Fournir une instance factice pour éviter les erreurs côté serveur\n        db = {};\n    }\n} else {}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXFEO0FBQ0g7QUFDbEI7QUFFaEMsdURBQXVEO0FBQ3ZELE1BQU1HLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxrQkFBa0JILGtOQUF5QztBQUNqRSxNQUFNSyxxQkFBcUJMLFFBQVFDLEdBQUcsQ0FBQ0ssb0JBQW9CO0FBRTNELHNEQUFzRDtBQUN0RCxJQUFJLENBQUNQLGFBQWE7SUFDaEIsTUFBTSxJQUFJUSxNQUFNO0FBQ2xCO0FBQ0EsSUFBSSxDQUFDSixpQkFBaUI7SUFDcEIsTUFBTSxJQUFJSSxNQUFNO0FBQ2xCO0FBRUEsc0ZBQXNGO0FBQy9FLE1BQU1DLFdBQVdaLG1FQUFZQSxDQUFDRyxhQUFhSSxpQkFBaUI7QUFFbkUsMEdBQTBHO0FBQ25HLE1BQU1NLGdCQUFnQkoscUJBQ3pCVCxtRUFBWUEsQ0FBQ0csYUFBYU0sc0JBQzFCRyxTQUFTO0FBRWIsaURBQWlEO0FBQ2pELElBQUlFO0FBRUosbUNBQW1DO0FBQ25DLFNBQVNDO0lBQ1AsTUFBTUMsY0FBY1osUUFBUUMsR0FBRyxDQUFDWSxZQUFZO0lBRTVDLElBQUksQ0FBQ0QsYUFBYTtRQUNoQkUsUUFBUUMsS0FBSyxDQUFDO1FBQ2QsTUFBTSxJQUFJUixNQUFNO0lBQ2xCO0lBRUEsSUFBSTtRQUNGLG9FQUFvRTtRQUNwRSxNQUFNUyxTQUFTbEIsb0RBQVFBLENBQUNjLGFBQWE7WUFDbkNLLEtBQUs7WUFDTEMsY0FBYztZQUNkQyxpQkFBaUI7WUFDakJDLFNBQVM7UUFDWDtRQUVBLDZCQUE2QjtRQUM3QixPQUFPdkIsZ0VBQU9BLENBQUNtQjtJQUNqQixFQUFFLE9BQU9ELE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLCtDQUErQ0E7UUFDN0QsTUFBTUE7SUFDUjtBQUNGO0FBRUEsMERBQTBEO0FBQzFELElBQUksSUFBNkIsRUFBRTtJQUNqQyxJQUFJO1FBQ0ZMLEtBQUtDO0lBQ1AsRUFBRSxPQUFPSSxPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQywrQ0FBK0NBO1FBQzdELG9FQUFvRTtRQUNwRUwsS0FBSyxDQUFDO0lBQ1I7QUFDRixPQUFPLEVBR047QUFFYSIsInNvdXJjZXMiOlsiL1VzZXJzL2NoYXJsZXMtaGVucnlub2FoL0Rlc2t0b3Avdml6aW9uL1Zpemlvbi9saWIvZGIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7IGRyaXp6bGUgfSBmcm9tICdkcml6emxlLW9ybS9wb3N0Z3Jlcy1qcyc7XG5pbXBvcnQgcG9zdGdyZXMgZnJvbSAncG9zdGdyZXMnO1xuXG4vLyBSZWFkIFN1cGFiYXNlIGNyZWRlbnRpYWxzIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9LRVk7XG5cbi8vIEJhc2ljIGNoZWNrIHRvIGVuc3VyZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIHNldFxuaWYgKCFzdXBhYmFzZVVybCkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJTdXBhYmFzZSBVUkwgbm90IGZvdW5kLiBNYWtlIHN1cmUgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGlzIHNldCBpbiB5b3VyIC5lbnYgZmlsZS5cIik7XG59XG5pZiAoIXN1cGFiYXNlQW5vbktleSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJTdXBhYmFzZSBBbm9uIEtleSBub3QgZm91bmQuIE1ha2Ugc3VyZSBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSBpcyBzZXQgaW4geW91ciAuZW52IGZpbGUuXCIpO1xufVxuXG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgU3VwYWJhc2UgY2xpZW50IGluc3RhbmNlIHdpdGggYW5vbnltb3VzIGtleSAoZm9yIGNsaWVudC1zaWRlKVxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuXG4vLyBDcmVhdGUgYSBTdXBhYmFzZSBjbGllbnQgd2l0aCBzZXJ2aWNlIHJvbGUga2V5IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zIHRoYXQgbmVlZCBlbGV2YXRlZCBwcml2aWxlZ2VzXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IHN1cGFiYXNlU2VydmljZUtleSBcbiAgPyBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSlcbiAgOiBzdXBhYmFzZTtcblxuLy8gQ29uZmlndXJhdGlvbiBwb3VyIERyaXp6bGUgT1JNIGF2ZWMgUG9zdGdyZVNRTFxubGV0IGRiOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXR1cERyaXp6bGU+O1xuXG4vLyBGb25jdGlvbiBwb3VyIGNvbmZpZ3VyZXIgRHJpenpsZVxuZnVuY3Rpb24gc2V0dXBEcml6emxlKCkge1xuICBjb25zdCBkYXRhYmFzZVVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTDtcbiAgXG4gIGlmICghZGF0YWJhc2VVcmwpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiREFUQUJBU0VfVVJMIGlzIG5vdCBkZWZpbmVkIGluIGVudmlyb25tZW50IHZhcmlhYmxlc1wiKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEQVRBQkFTRV9VUkwgaXMgbm90IGRlZmluZWQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzXCIpO1xuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIENyw6llciB1biBjbGllbnQgUG9zdGdyZVNRTCBhdmVjIGRlcyBvcHRpb25zIGRlIGNvbm5leGlvbiByb2J1c3Rlc1xuICAgIGNvbnN0IGNsaWVudCA9IHBvc3RncmVzKGRhdGFiYXNlVXJsLCB7XG4gICAgICBtYXg6IDEwLCAvLyBub21icmUgbWF4aW11bSBkZSBjb25uZXhpb25zIGRhbnMgbGUgcG9vbFxuICAgICAgaWRsZV90aW1lb3V0OiAyMCwgLy8gdGVtcHMgZCdpbmFjdGl2aXTDqSBhdmFudCBkZSBmZXJtZXIgdW5lIGNvbm5leGlvbiAoZW4gc2Vjb25kZXMpXG4gICAgICBjb25uZWN0X3RpbWVvdXQ6IDMwLCAvLyB0ZW1wcyBtYXhpbXVtIHBvdXIgw6l0YWJsaXIgdW5lIGNvbm5leGlvbiAoZW4gc2Vjb25kZXMpXG4gICAgICBwcmVwYXJlOiBmYWxzZSwgLy8gZMOpc2FjdGl2ZXIgbGEgcHLDqXBhcmF0aW9uIGRlcyByZXF1w6p0ZXMgcG91ciBwbHVzIGRlIGNvbXBhdGliaWxpdMOpXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQ3LDqWVyIHVuZSBpbnN0YW5jZSBEcml6emxlXG4gICAgcmV0dXJuIGRyaXp6bGUoY2xpZW50KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyZXVyIGxvcnMgZGUgbGEgY29uZmlndXJhdGlvbiBkZSBEcml6emxlOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gSW5pdGlhbGlzZXIgRHJpenpsZSBlbiBlbnZpcm9ubmVtZW50IHNlcnZldXIgdW5pcXVlbWVudFxuaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gIHRyeSB7XG4gICAgZGIgPSBzZXR1cERyaXp6bGUoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyZXVyIGxvcnMgZGUgbCdpbml0aWFsaXNhdGlvbiBkZSBEcml6emxlOlwiLCBlcnJvcik7XG4gICAgLy8gRm91cm5pciB1bmUgaW5zdGFuY2UgZmFjdGljZSBwb3VyIMOpdml0ZXIgbGVzIGVycmV1cnMgY8O0dMOpIHNlcnZldXJcbiAgICBkYiA9IHt9IGFzIFJldHVyblR5cGU8dHlwZW9mIHNldHVwRHJpenpsZT47XG4gIH1cbn0gZWxzZSB7XG4gIC8vIEZvdXJuaXIgdW5lIGluc3RhbmNlIGZhY3RpY2UgcG91ciBsZSBjw7R0w6kgY2xpZW50XG4gIGRiID0ge30gYXMgUmV0dXJuVHlwZTx0eXBlb2Ygc2V0dXBEcml6emxlPjtcbn1cblxuZXhwb3J0IHsgZGIgfTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJkcml6emxlIiwicG9zdGdyZXMiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsInN1cGFiYXNlQWRtaW4iLCJkYiIsInNldHVwRHJpenpsZSIsImRhdGFiYXNlVXJsIiwiREFUQUJBU0VfVVJMIiwiY29uc29sZSIsImVycm9yIiwiY2xpZW50IiwibWF4IiwiaWRsZV90aW1lb3V0IiwiY29ubmVjdF90aW1lb3V0IiwicHJlcGFyZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/@babel","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/drizzle-orm","vendor-chunks/postgres"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fprojects%2Froute&page=%2Fapi%2Fprojects%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprojects%2Froute.ts&appDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcharles-henrynoah%2FDesktop%2Fvizion%2FVizion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();